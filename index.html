<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Salary Slip Generator</title>

<style>
body { font-family: Arial; background:#f2f2f2; padding:10px; }
.card { background:#fff; padding:15px; border-radius:10px; }
input, select, button {
  width:100%; padding:10px; margin:6px 0;
}
button {
  background:#0a7cff; color:#fff; border:none; font-size:16px;
}
.result { margin-top:10px; font-weight:bold; }
</style>
</head>

<body>
<div class="card">
<h3>Salary Slip Generator</h3>

<input id="name" placeholder="Worker Name">

<select id="designation"></select>

<input type="number" id="wd" placeholder="Working Days">
<input type="number" id="ot" placeholder="OT Hours">
<input type="number" id="sun" placeholder="Sundays (Not Paid)">
<input type="number" id="nh" placeholder="National Holidays">
<input type="number" id="el" placeholder="EL">
<input type="number" id="cl" placeholder="CL">
<input type="number" id="adv" placeholder="Advance">

<button onclick="calculate()">Generate Salary</button>

<div class="result" id="out"></div>
</div>

<script>
let payroll = {};

google.script.run.withSuccessHandler(loadDesignations).getDesignations();

function loadDesignations(list) {
  const d = document.getElementById("designation");
  d.innerHTML = "<option value=''>Select Designation</option>";
  list.forEach(x => d.innerHTML += `<option>${x}</option>`);
}

document.getElementById("designation").addEventListener("change", function () {
  google.script.run.withSuccessHandler(p => payroll = p)
    .getPayrollByDesignation(this.value);
});

function calculate() {
  const wd = +v("wd");
  const nh = +v("nh");
  const el = +v("el");
  const cl = +v("cl");
  const ot = +v("ot");
  const adv = +v("adv");

  const perDay = payroll.gross / 26;

  // ✅ UPDATED LOGIC (Sunday excluded)
  const earnedAmount = perDay * (wd + nh + el + cl);

  const otAmount = ot * payroll.otRate;
  const totalEarning = earnedAmount + otAmount;
  const totalDeduction = payroll.pf + payroll.esi + payroll.pt + adv;

  const netPay = Math.round(totalEarning - totalDeduction);

  document.getElementById("out").innerHTML =
    "Net Pay : ₹ " + netPay;

  google.script.run.saveSalarySlip({
    name: v("name"),
    designation: v("designation"),
    workingDays: wd,
    otHours: ot,
    sunday: v("sun"),
    nh: nh,
    el: el,
    cl: cl,
    gross: payroll.gross,
    otAmount: otAmount,
    pf: payroll.pf,
    esi: payroll.esi,
    pt: payroll.pt,
    netPay: netPay
  });
}

function v(id) {
  return document.getElementById(id).value;
}
</script>
</body>
</html>
